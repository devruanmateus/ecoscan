<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecoscan</title>
    <link rel="stylesheet" href="styles/iniciostyle.css">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <header>
        <div id="container-header">
            <div id="logotipo">
                <h1><a href="inicio.html">EcoScan</a></h1>
            </div>
            <div id="menu">
                <nav>
                    <li><a href="inicio.html" id="inicio">Inicio</a></li>
                    <li><a href="scanner.html">Scanner</a></li>
                    <li><a href="sobre.html">Sobre</a></li>
                </nav>
            </div>
            <div id="login">
                <!-- Ative a visualização do cadastro e login quando os mesmos estiverem funcionando -->
                <h4 id="signup-view"><a href="login.html">Entre</a> | <a href="cadastrar.html">Cadastre-se</a></h4>
                <h4 id="username"><a href="#">Usuário</a></h4>
                <img src="imagens/menu.png" alt="Menu" width="18" id="menu-icon">
                <img src="imagens/user.png" alt="Usuário" width="25" id="user-icon">
                <menu>
                    <ul>
                        <li><a href="scanner.html" id="scanner">Scanner</a></li>
                        <li><a href="painel.html" id="painel">Painel</a></li>
                        <li><a href="#" id="my-account">Minha conta</a></li>
                        <li><a href="#" id="my-profile">Meu perfil</a></li>
                        <li><a href="#" id="help-center">Central de ajuda</a></li>
                        <li><a href="#" id="suporte">Suporte</a></li>
                        <li><a href="sobre.html" id="about">Sobre nós</a></li>
                    </ul>
                </menu>
            </div>
            </div>
        </div>
    </header>
    <main>
        <div id="container-scanner">
            <h1>Faça uma análise de solo degradado</h1> 
            <div id="img-preview">
                <img id="inputImage" src="#" alt="Imagem do solo degradado">
            </div>
    
            <div class="file-input-container">
                <label for="fileInput" class="custom-file-upload">Selecionar arquivo</label>
                <input type="file" id="fileInput" accept="image/*">
            </div>   
            <div id="result"></div>
        </div>
    
        <script>
           document.getElementById('fileInput').addEventListener('change', function(event) {
    var file = event.target.files[0];
    var reader = new FileReader();

    reader.onload = function() {
        var img = new Image();
        img.onload = function() {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var data = imageData.data;

            // Initialize counters for each degradation level
            var countHighlyDegraded = 0;
            var countModeratelyDegraded = 0;
            var countSlightlyDegraded = 0;
            var countNotDegraded = 0;

            // Loop through each pixel
            for (var i = 0; i < data.length; i += 4) {
                var red = data[i];
                var green = data[i + 1];
                var blue = data[i + 2];

                // Calculate average brightness of the pixel
                var brightness = (red + green + blue) / 3;

                // Determine degradation level based on color values and brightness
                if (red > 200 && green < 150 && blue < 150 && brightness < 180) {
                    countHighlyDegraded++;
                } else if (red > 150 && green < 200 && blue < 150 && brightness < 200) {
                    countModeratelyDegraded++;
                } else if (red > 100 && green < 250 && blue < 200 && brightness < 220) {
                    countSlightlyDegraded++;
                } else {
                    countNotDegraded++;
                }
            }

            // Calculate total number of pixels
            var totalPixels = imageData.data.length / 4;

            // Calculate percentages
            var percentualNotDegraded = (countNotDegraded / totalPixels) * 100;
            var percentualHighlyDegraded = (countHighlyDegraded / totalPixels) * 100;
            var percentualModeratelyDegraded = (countModeratelyDegraded / totalPixels) * 100;
            var percentualSlightlyDegraded = (countSlightlyDegraded / totalPixels) * 100;

            // Determine the overall degradation status
            var degradationStatus = 'Indeterminado'; // Default
            if (countNotDegraded > countModeratelyDegraded && countNotDegraded > countSlightlyDegraded) {
                degradationStatus = 'Solo não degradado';
            } else if (countModeratelyDegraded > countNotDegraded && countModeratelyDegraded > countSlightlyDegraded) {
                degradationStatus = 'Solo degradado';
            } else if (countSlightlyDegraded > countNotDegraded && countSlightlyDegraded > countModeratelyDegraded) {
                degradationStatus = 'Solo degradado';
            }

            // Display result
            var resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p id="title-result">Resultado da análise:</p>' +
                                  '<ul>' +
                                  '<li>Solo não degradado: ' + percentualNotDegraded.toFixed(2) + '%</li>' +
                                  '<li>[1] Solo degradado: ' + percentualModeratelyDegraded.toFixed(2) + '%</li>' +
                                  '<li>[2] Solo degradado: ' + percentualSlightlyDegraded.toFixed(2) + '%</li>' +
                                  '</ul>' +
                                  '<p id="status-solo">Status de degradação do solo: <strong>' + degradationStatus + '</strong></p>';

        };

        img.src = reader.result;
        document.getElementById('inputImage').src = reader.result;
    };

    reader.readAsDataURL(file);
});
        </script>
    </main>

    <div id="content">

    </div>

    <footer>
        <p>Feira de Ciências &copy;</p>
    </footer>
</body>
</html>